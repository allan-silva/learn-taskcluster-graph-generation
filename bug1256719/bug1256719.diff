commit f183987abc5e8cb6e481b1de60bf084bc52e5289
Author: Allan Silva <allan@allansilva.com.br>
Date:   Fri Feb 21 07:50:27 2020 -0300

    Bug 1256719 - mark releases as read only after balrog submission is complete

diff --git a/taskcluster/ci/release-balrog-set-readonly/kind.yml b/taskcluster/ci/release-balrog-set-readonly/kind.yml
new file mode 100644
index 000000000000..f8ff93fc045e
--- /dev/null
+++ b/taskcluster/ci/release-balrog-set-readonly/kind.yml
@@ -0,0 +1,45 @@
+# This Source Code Form is subject to the terms of the Mozilla Public
+# License, v. 2.0. If a copy of the MPL was not distributed with this
+# file, You can obtain one at http://mozilla.org/MPL/2.0/.
+---
+loader: taskgraph.loader.transform:loader
+
+transforms:
+    - taskgraph.transforms.release:run_on_releases
+    - taskgraph.transforms.release_deps:transforms
+    - taskgraph.transforms.scriptworker:add_balrog_scopes
+    - taskgraph.transforms.task:transforms
+
+kind-dependencies:
+    - release-bouncer-check
+    - release-push-langpacks
+
+job-defaults:
+    run-on-projects: []
+    shipping-phase: ship
+    worker-type: balrog
+    worker:
+        implementation: balrog
+        balrog-action: set-readonly
+
+jobs:
+    firefox:
+        description: Set Firefox release as readonly in balrog
+        name: release-firefox_set_readonly_in_balrog
+        shipping-product: firefox
+        worker:
+            product: firefox
+    firefox-bz2:
+        description: Set Firefox release as readonly in balrog (bz2)
+        name: release-firefox_set_readonly_in_balrog-bz2
+        shipping-product: firefox
+        run-on-releases: [esr68]
+        worker:
+            product: firefox
+            blob-suffix: -bz2
+    devedition:
+        description: Set Devedition release as readonly in balrog
+        name: release-devedition_set_readonly_in_balrog
+        shipping-product: devedition
+        worker:
+            product: devedition
\ No newline at end of file
diff --git a/taskcluster/docs/kinds.rst b/taskcluster/docs/kinds.rst
index e50eae95e0bd..d0894f9cda47 100644
--- a/taskcluster/docs/kinds.rst
+++ b/taskcluster/docs/kinds.rst
@@ -274,6 +274,10 @@ release-balrog-scheduling
 Schedules a Release for shipping in Balrog. If a `release_eta` was provided when starting the Release,
 it will be scheduled to go live at that day and time.
 
+release-balrog-set-readonly
+-------------------------
+Set a Release as readonly after release goes live.
+
 release-secondary-balrog-scheduling
 -----------------------------------
 Performs the same function as `release-balrog-scheduling`, except for the beta channel as part of RC
diff --git a/taskcluster/taskgraph/transforms/task.py b/taskcluster/taskgraph/transforms/task.py
index c20bf6d35e7a..034a47c59b4f 100644
--- a/taskcluster/taskgraph/transforms/task.py
+++ b/taskcluster/taskgraph/transforms/task.py
@@ -1113,6 +1113,8 @@ def build_balrog_payload(config, task, task_def):
             'product': worker['product'],
             'version': release_config['version'],
         }
+        if worker['balrog-action'] == 'set-readonly':
+            return
         for prop in ('blob-suffix', 'complete-mar-filename-pattern',
                      'complete-mar-bouncer-product-pattern'):
             if prop in worker:
diff --git a/taskcluster/taskgraph/util/scriptworker.py b/taskcluster/taskgraph/util/scriptworker.py
index e0b061b708c4..a9098c4aad94 100644
--- a/taskcluster/taskgraph/util/scriptworker.py
+++ b/taskcluster/taskgraph/util/scriptworker.py
@@ -118,7 +118,7 @@ BEETMOVER_ACTION_SCOPES = {
 
 
 """Known balrog actions."""
-BALROG_ACTIONS = ('submit-locale', 'submit-toplevel', 'schedule')
+BALROG_ACTIONS = ('submit-locale', 'submit-toplevel', 'schedule', 'set-readonly')
 
 """Map balrog scope aliases to sets of projects.
 
